<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JK Algo</title>
  <style>
    :root{
      --bg:#0f1722; --panel:#111b27; --text:#e6edf3; --muted:#9fb0c0;
      --accent:#4ea1ff; --chip:#1b2a3a; --chip-active:#22374d;
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:920px;margin:0 auto;padding:16px}
    .navbar{position:sticky;top:0;z-index:20;background:rgba(15,23,34,.9);backdrop-filter:saturate(120%) blur(8px);border-bottom:1px solid #1e2a38}
    .nav{display:flex;gap:12px;align-items:center;padding:12px 16px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .tabs{margin-left:auto;display:flex;gap:8px}
    .tab{padding:10px 16px;border-radius:12px;background:var(--chip);color:var(--muted);border:1px solid #1e2a38}
    .tab.active{color:var(--text);background:var(--chip-active);border-color:#2a3e55}
    .cap{position:fixed;right:12px;top:64px;z-index:15;background:#0e1621;border:1px solid #203146;border-radius:14px;padding:10px 14px;box-shadow:0 8px 24px rgba(0,0,0,.35)}
    .cap b{display:block}
    .card{background:var(--panel);border:1px solid #1e2a38;border-radius:var(--radius);padding:16px}
    h1,h2{margin:0 0 12px 0}
    label{display:block;font-size:14px;color:var(--muted);margin:14px 0 6px}
    select,button,.btn{
      width:100%;background:#0f1b28;color:var(--text);border:1px solid #213344;border-radius:12px;
      min-height:44px;padding:10px 12px;font-size:16px
    }
    button.primary{background:#173450;border-color:#27527a}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:640px){.row{grid-template-columns:1fr}}
    .mt{margin-top:16px}
    .hide{display:none}
    .note{color:var(--muted);font-size:12px}
    #tvwrap{margin-top:12px}
    #tvchart{width:100%;height:520px;border-radius:14px;overflow:hidden;border:1px solid #1e2a38}
  </style>

  <!-- TradingView Widget script -->
  <script src="https://s3.tradingview.com/tv.js"></script>
</head>
<body>
  <div class="navbar">
    <div class="nav wrap">
      <div class="brand">ðŸ“ˆ <span>JK Algo</span></div>
      <div class="tabs">
        <button class="tab active" data-tab="home">Home</button>
        <button class="tab" data-tab="market">Market</button>
        <button class="tab" data-tab="positions">Positions</button>
      </div>
    </div>
  </div>

  <div class="cap" id="capBox">
    <b>Capital: $<span id="capVal">1000.00</span></b>
    PnL: <span id="pnlVal">$0.00</span> Â· Margin: <span id="mgnVal">$0.00</span>
  </div>

  <main class="wrap">

    <!-- HOME -->
    <section id="home" class="card">
      <h1>JK ALGO Setup</h1>
      <div class="row">
        <div>
          <label>Pair</label>
          <select id="homePair">
            <option>BTC/USDT</option>
            <option>ETH/USDT</option>
            <option>SOL/USDT</option>
            <option>XRP/USDT</option>
            <option>GOLD (XAU/USD)</option>
            <option>USOIL (WTI)</option>
          </select>
        </div>
        <div>
          <label>Timeframe</label>
          <select id="homeTf">
            <option value="1">1m</option>
            <option value="5" selected>5m</option>
            <option value="15">15m</option>
            <option value="60">1h</option>
            <option value="240">4h</option>
          </select>
        </div>
      </div>

      <div class="row mt">
        <button class="primary" id="homeApply">Start / Apply to Chart</button>
        <button id="homeStop">Stop</button>
      </div>

      <p class="note mt">Frontend demo only â€” signals/chart. Real trading later plug-in.</p>

      <div id="tvwrap" class="mt">
        <div id="tvchart"></div>
      </div>
    </section>

    <!-- MARKET -->
    <section id="market" class="card hide">
      <h1>Market</h1>
      <label>Pair</label>
      <select id="mPair">
        <option>BTC/USDT</option>
        <option>ETH/USDT</option>
        <option>SOL/USDT</option>
        <option>XRP/USDT</option>
        <option>GOLD (XAU/USD)</option>
        <option>USOIL (WTI)</option>
      </select>
      <label class="mt">Timeframe</label>
      <select id="mTf">
        <option value="1">1m</option>
        <option value="5" selected>5m</option>
        <option value="15">15m</option>
        <option value="60">1h</option>
        <option value="240">4h</option>
      </select>
      <button class="mt primary" id="mReload">Reload</button>

      <div id="tvwrap2" class="mt">
        <div id="tvchart2"></div>
      </div>
    </section>

    <!-- POSITIONS -->
    <section id="positions" class="card hide">
      <h1>Positions</h1>
      <p class="note">Demo: yahan open / pending / closed positions dikhayenge (UI ready, engine later).</p>
      <div class="row mt">
        <div class="card"><h2>Open</h2><div id="posOpen" class="note">No positions.</div></div>
        <div class="card"><h2>Pending</h2><div id="posPend" class="note">None.</div></div>
      </div>
      <div class="card mt"><h2>Closed</h2><div id="posClosed" class="note">None.</div></div>
    </section>
  </main>

  <script>
    // ---------------- Tabs ----------------
    const tabs  = document.querySelectorAll('.tab');
    const pages = { home:document.getElementById('home'),
                    market:document.getElementById('market'),
                    positions:document.getElementById('positions') };

    function showTab(name){
      Object.entries(pages).forEach(([k,el])=> el.classList.toggle('hide', k!==name));
      tabs.forEach(t => t.classList.toggle('active', t.dataset.tab===name));
      localStorage.setItem('jk.activeTab', name);
    }
    tabs.forEach(t => t.addEventListener('click', ()=> showTab(t.dataset.tab)));
    showTab(localStorage.getItem('jk.activeTab') || 'home');

    // ---------------- Capital badge demo ----------------
    const capVal = document.getElementById('capVal');
    capVal.textContent = (localStorage.getItem('jk.capital') || '1000.00');

    // ---------------- Symbol mapping (FIX) ----------------
    function symMap(label){
      // Non-crypto
      if (label === 'GOLD (XAU/USD)') return 'OANDA:XAUUSD';
      if (label === 'USOIL (WTI)')     return 'TVC:USOIL';

      // Crypto like "BTC/USDT" -> "BINANCE:BTCUSDT"
      if (label.includes('/')){
        const clean = label.replace('/','').toUpperCase();
        return 'BINANCE:' + clean;
      }
      // Fallback
      return 'BINANCE:BTCUSDT';
    }

    // ---------------- TradingView loader ----------------
    let tv1 = null, tv2 = null;

    function loadTV(containerId, symbol, interval, theme='dark'){
      // Destroy old if exists
      if (containerId==='tvchart' && tv1 && tv1.remove) tv1.remove();
      if (containerId==='tvchart2' && tv2 && tv2.remove) tv2.remove();

      const opts = {
        autosize: true,
        symbol: symbol,
        interval: interval,         // "1","5","15","60","240"
        timezone: "Etc/UTC",
        theme: theme,
        style: "1",
        locale: "en",
        hide_top_toolbar: true,
        hide_legend: false,
        hide_side_toolbar: true,
        allow_symbol_change: false,
        container_id: containerId
      };
      const w = new TradingView.widget(opts);
      if (containerId==='tvchart') tv1 = w; else tv2 = w;
    }

    // --------------- HOME bind ---------------
    const homePair = document.getElementById('homePair');
    const homeTf   = document.getElementById('homeTf');
    const homeApply= document.getElementById('homeApply');

    // restore last selections
    homePair.value = localStorage.getItem('jk.homePair') || 'BTC/USDT';
    homeTf.value   = localStorage.getItem('jk.homeTf')   || '5';

    function applyHome(){
      localStorage.setItem('jk.homePair', homePair.value);
      localStorage.setItem('jk.homeTf',   homeTf.value);
      loadTV('tvchart', symMap(homePair.value), homeTf.value);
    }
    homeApply.addEventListener('click', applyHome);

    // --------------- MARKET bind ---------------
    const mPair = document.getElementById('mPair');
    const mTf   = document.getElementById('mTf');
    const mReload = document.getElementById('mReload');

    mPair.value = localStorage.getItem('jk.mPair') || 'BTC/USDT';
    mTf.value   = localStorage.getItem('jk.mTf')   || '5';

    function applyMarket(){
      localStorage.setItem('jk.mPair', mPair.value);
      localStorage.setItem('jk.mTf',   mTf.value);
      loadTV('tvchart2', symMap(mPair.value), mTf.value);
    }
    mReload.addEventListener('click', applyMarket);

    // First paint (so user immediately sees charts)
    applyHome();
    applyMarket();
  </script>
</body>
</html>
